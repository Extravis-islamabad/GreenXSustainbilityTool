{"version":3,"file":"index.esm.js","sources":["../src/Canvas2DContextService.ts","../src/ContextRegisterPlugin.ts","../src/index.ts"],"sourcesContent":["import { __awaiter, __generator } from \"tslib\";\nimport { RenderReason, isBrowser, setDOMSize } from '@antv/g-lite';\nimport { isString } from '@antv/util';\nvar Canvas2DContextService = /** @class */ (function () {\n    function Canvas2DContextService(context) {\n        this.renderingContext = context.renderingContext;\n        this.canvasConfig = context.config;\n    }\n    Canvas2DContextService.prototype.init = function () {\n        var _a = this.canvasConfig, container = _a.container, canvas = _a.canvas;\n        if (canvas) {\n            this.$canvas = canvas;\n            if (container &&\n                canvas.parentElement !== container) {\n                container.appendChild(canvas);\n            }\n            this.$container = canvas.parentElement;\n            this.canvasConfig.container = this.$container;\n        }\n        else if (container) {\n            // create container\n            this.$container = isString(container)\n                ? document.getElementById(container)\n                : container;\n            if (this.$container) {\n                // create canvas\n                var $canvas = document.createElement('canvas');\n                this.$container.appendChild($canvas);\n                if (!this.$container.style.position) {\n                    this.$container.style.position = 'relative';\n                }\n                this.$canvas = $canvas;\n            }\n        }\n        this.context = this.$canvas.getContext('2d');\n        this.resize(this.canvasConfig.width, this.canvasConfig.height);\n    };\n    Canvas2DContextService.prototype.getContext = function () {\n        return this.context;\n    };\n    Canvas2DContextService.prototype.getDomElement = function () {\n        return this.$canvas;\n    };\n    Canvas2DContextService.prototype.getDPR = function () {\n        return this.dpr;\n    };\n    Canvas2DContextService.prototype.getBoundingClientRect = function () {\n        if (this.$canvas.getBoundingClientRect) {\n            return this.$canvas.getBoundingClientRect();\n        }\n    };\n    Canvas2DContextService.prototype.destroy = function () {\n        // @ts-ignore\n        if (this.$container && this.$canvas && this.$canvas.parentNode) {\n            // destroy context\n            // @ts-ignore\n            this.$container.removeChild(this.$canvas);\n        }\n    };\n    Canvas2DContextService.prototype.resize = function (width, height) {\n        var devicePixelRatio = this.canvasConfig.devicePixelRatio;\n        // use user-defined dpr first\n        var dpr = devicePixelRatio || (isBrowser && window.devicePixelRatio) || 1;\n        dpr = dpr >= 1 ? Math.ceil(dpr) : 1;\n        this.dpr = dpr;\n        if (this.$canvas) {\n            // set canvas width & height\n            this.$canvas.width = this.dpr * width;\n            this.$canvas.height = this.dpr * height;\n            // set CSS style width & height\n            setDOMSize(this.$canvas, width, height);\n            // const dpr = this.getDPR();\n            // scale all drawing operations by the dpr\n            // @see https://www.html5rocks.com/en/tutorials/canvas/hidpi/\n            // this.context.scale(dpr, dpr);\n        }\n        this.renderingContext.renderReasons.add(RenderReason.CAMERA_CHANGED);\n    };\n    Canvas2DContextService.prototype.applyCursorStyle = function (cursor) {\n        if (this.$container && this.$container.style) {\n            this.$container.style.cursor = cursor;\n        }\n    };\n    Canvas2DContextService.prototype.toDataURL = function (options) {\n        if (options === void 0) { options = {}; }\n        return __awaiter(this, void 0, void 0, function () {\n            var type, encoderOptions;\n            return __generator(this, function (_a) {\n                type = options.type, encoderOptions = options.encoderOptions;\n                return [2 /*return*/, this.context.canvas.toDataURL(type, encoderOptions)];\n            });\n        });\n    };\n    return Canvas2DContextService;\n}());\nexport { Canvas2DContextService };\n//# sourceMappingURL=Canvas2DContextService.js.map","import { __extends } from \"tslib\";\nimport { AbstractRendererPlugin } from '@antv/g-lite';\nimport { Canvas2DContextService } from './Canvas2DContextService';\nvar ContextRegisterPlugin = /** @class */ (function (_super) {\n    __extends(ContextRegisterPlugin, _super);\n    function ContextRegisterPlugin() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.name = 'canvas-context-register';\n        return _this;\n    }\n    ContextRegisterPlugin.prototype.init = function () {\n        this.context.ContextService = Canvas2DContextService;\n    };\n    ContextRegisterPlugin.prototype.destroy = function () {\n        delete this.context.ContextService;\n    };\n    return ContextRegisterPlugin;\n}(AbstractRendererPlugin));\nexport { ContextRegisterPlugin };\n//# sourceMappingURL=ContextRegisterPlugin.js.map","import { __extends } from \"tslib\";\nimport { AbstractRenderer } from '@antv/g-lite';\nimport * as CanvasPathGenerator from '@antv/g-plugin-canvas-path-generator';\nimport * as CanvasPicker from '@antv/g-plugin-canvas-picker';\nimport * as CanvasRenderer from '@antv/g-plugin-canvas-renderer';\nimport * as DomInteraction from '@antv/g-plugin-dom-interaction';\nimport * as HTMLRenderer from '@antv/g-plugin-html-renderer';\nimport * as ImageLoader from '@antv/g-plugin-image-loader';\nimport { ContextRegisterPlugin } from './ContextRegisterPlugin';\nexport { CanvasPathGenerator, CanvasPicker, CanvasRenderer, DomInteraction, HTMLRenderer, ImageLoader, };\nvar Renderer = /** @class */ (function (_super) {\n    __extends(Renderer, _super);\n    function Renderer(config) {\n        var _this = _super.call(this, config) || this;\n        // register Canvas2DContext\n        _this.registerPlugin(new ContextRegisterPlugin());\n        _this.registerPlugin(new ImageLoader.Plugin());\n        _this.registerPlugin(new CanvasPathGenerator.Plugin());\n        // enable rendering with Canvas2D API\n        _this.registerPlugin(new CanvasRenderer.Plugin());\n        _this.registerPlugin(new DomInteraction.Plugin());\n        // enable picking with Canvas2D API\n        _this.registerPlugin(new CanvasPicker.Plugin());\n        // render HTML component\n        _this.registerPlugin(new HTMLRenderer.Plugin());\n        return _this;\n    }\n    return Renderer;\n}(AbstractRenderer));\nexport { Renderer };\n//# sourceMappingURL=index.js.map"],"names":[],"mappings":"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"}