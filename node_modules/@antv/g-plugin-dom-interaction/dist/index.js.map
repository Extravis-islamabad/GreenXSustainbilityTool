{"version":3,"file":"index.js","sources":["../src/DOMInteractionPlugin.ts","../src/index.ts"],"sourcesContent":["// const MOBILE_REGEX = /mobile|tablet|ip(ad|hone|od)|android/i;\n/**\n * listen to mouse/touch/pointer events on DOM wrapper, trigger pointer events\n */\nvar DOMInteractionPlugin = /** @class */ (function () {\n    function DOMInteractionPlugin() {\n    }\n    DOMInteractionPlugin.prototype.apply = function (context, runtime) {\n        var _this = this;\n        var renderingService = context.renderingService, renderingContext = context.renderingContext, config = context.config;\n        this.context = context;\n        var canvas = renderingContext.root.ownerDocument.defaultView;\n        // const SUPPORT_ONLY_TOUCH = canvas.supportsTouchEvents && MOBILE_REGEX.test(navigator.userAgent);\n        var onPointerMove = function (ev) {\n            renderingService.hooks.pointerMove.call(ev);\n        };\n        var onPointerUp = function (ev) {\n            renderingService.hooks.pointerUp.call(ev);\n        };\n        var onPointerDown = function (ev) {\n            renderingService.hooks.pointerDown.call(ev);\n        };\n        var onPointerOver = function (ev) {\n            renderingService.hooks.pointerOver.call(ev);\n        };\n        var onPointerOut = function (ev) {\n            renderingService.hooks.pointerOut.call(ev);\n        };\n        var onPointerCancel = function (ev) {\n            renderingService.hooks.pointerCancel.call(ev);\n        };\n        var onPointerWheel = function (ev) {\n            renderingService.hooks.pointerWheel.call(ev);\n        };\n        var onClick = function (ev) {\n            renderingService.hooks.click.call(ev);\n        };\n        var addPointerEventListener = function ($el) {\n            runtime.globalThis.document.addEventListener('pointermove', onPointerMove, true);\n            $el.addEventListener('pointerdown', onPointerDown, true);\n            $el.addEventListener('pointerleave', onPointerOut, true);\n            $el.addEventListener('pointerover', onPointerOver, true);\n            runtime.globalThis.addEventListener('pointerup', onPointerUp, true);\n            runtime.globalThis.addEventListener('pointercancel', onPointerCancel, true);\n        };\n        var addTouchEventListener = function ($el) {\n            $el.addEventListener('touchstart', onPointerDown, true);\n            $el.addEventListener('touchend', onPointerUp, true);\n            $el.addEventListener('touchmove', onPointerMove, true);\n            $el.addEventListener('touchcancel', onPointerCancel, true);\n        };\n        var addMouseEventListener = function ($el) {\n            runtime.globalThis.document.addEventListener('mousemove', onPointerMove, true);\n            $el.addEventListener('mousedown', onPointerDown, true);\n            $el.addEventListener('mouseout', onPointerOut, true);\n            $el.addEventListener('mouseover', onPointerOver, true);\n            runtime.globalThis.addEventListener('mouseup', onPointerUp, true);\n        };\n        var removePointerEventListener = function ($el) {\n            runtime.globalThis.document.removeEventListener('pointermove', onPointerMove, true);\n            $el.removeEventListener('pointerdown', onPointerDown, true);\n            $el.removeEventListener('pointerleave', onPointerOut, true);\n            $el.removeEventListener('pointerover', onPointerOver, true);\n            runtime.globalThis.removeEventListener('pointerup', onPointerUp, true);\n        };\n        var removeTouchEventListener = function ($el) {\n            $el.removeEventListener('touchstart', onPointerDown, true);\n            $el.removeEventListener('touchend', onPointerUp, true);\n            $el.removeEventListener('touchmove', onPointerMove, true);\n            $el.removeEventListener('touchcancel', onPointerCancel, true);\n        };\n        var removeMouseEventListener = function ($el) {\n            runtime.globalThis.document.removeEventListener('mousemove', onPointerMove, true);\n            $el.removeEventListener('mousedown', onPointerDown, true);\n            $el.removeEventListener('mouseout', onPointerOut, true);\n            $el.removeEventListener('mouseover', onPointerOver, true);\n            runtime.globalThis.removeEventListener('mouseup', onPointerUp, true);\n        };\n        renderingService.hooks.init.tap(DOMInteractionPlugin.tag, function () {\n            var $el = _this.context.contextService.getDomElement();\n            // @ts-ignore\n            if (runtime.globalThis.navigator.msPointerEnabled) {\n                // @ts-ignore\n                $el.style.msContentZooming = 'none';\n                // @ts-ignore\n                $el.style.msTouchAction = 'none';\n            }\n            else if (canvas.supportsPointerEvents) {\n                $el.style.touchAction = 'none';\n            }\n            if (canvas.supportsPointerEvents) {\n                addPointerEventListener($el);\n            }\n            else {\n                addMouseEventListener($el);\n            }\n            if (canvas.supportsTouchEvents) {\n                addTouchEventListener($el);\n            }\n            if (config.useNativeClickEvent) {\n                $el.addEventListener('click', onClick, true);\n            }\n            // use passive event listeners\n            // @see https://zhuanlan.zhihu.com/p/24555031\n            $el.addEventListener('wheel', onPointerWheel, {\n                passive: true,\n                capture: true,\n            });\n        });\n        renderingService.hooks.destroy.tap(DOMInteractionPlugin.tag, function () {\n            var $el = _this.context.contextService.getDomElement();\n            // @ts-ignore\n            if (runtime.globalThis.navigator.msPointerEnabled) {\n                // @ts-ignore\n                $el.style.msContentZooming = '';\n                // @ts-ignore\n                $el.style.msTouchAction = '';\n            }\n            else if (canvas.supportsPointerEvents) {\n                $el.style.touchAction = '';\n            }\n            if (canvas.supportsPointerEvents) {\n                removePointerEventListener($el);\n            }\n            else {\n                removeMouseEventListener($el);\n            }\n            if (canvas.supportsTouchEvents) {\n                removeTouchEventListener($el);\n            }\n            if (config.useNativeClickEvent) {\n                $el.removeEventListener('click', onClick, true);\n            }\n            $el.removeEventListener('wheel', onPointerWheel, true);\n        });\n    };\n    DOMInteractionPlugin.tag = 'DOMInteraction';\n    return DOMInteractionPlugin;\n}());\nexport { DOMInteractionPlugin };\n//# sourceMappingURL=DOMInteractionPlugin.js.map","import { __extends } from \"tslib\";\nimport { AbstractRendererPlugin } from '@antv/g-lite';\nimport { DOMInteractionPlugin } from './DOMInteractionPlugin';\nvar Plugin = /** @class */ (function (_super) {\n    __extends(Plugin, _super);\n    function Plugin() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.name = 'dom-interaction';\n        return _this;\n    }\n    Plugin.prototype.init = function () {\n        this.addRenderingPlugin(new DOMInteractionPlugin());\n    };\n    Plugin.prototype.destroy = function () {\n        this.removeAllRenderingPlugins();\n    };\n    return Plugin;\n}(AbstractRendererPlugin));\nexport { Plugin };\n//# sourceMappingURL=index.js.map"],"names":["__extends","AbstractRendererPlugin"],"mappings":";;;;;AAAA;AACA;AACA;AACA;AACA,IAAI,oBAAoB,kBAAkB,YAAY;AACtD,IAAI,SAAS,oBAAoB,GAAG;AACpC,KAAK;AACL,IAAI,oBAAoB,CAAC,SAAS,CAAC,KAAK,GAAG,UAAU,OAAO,EAAE,OAAO,EAAE;AACvE,QAAQ,IAAI,KAAK,GAAG,IAAI,CAAC;AACzB,QAAQ,IAAI,gBAAgB,GAAG,OAAO,CAAC,gBAAgB,EAAE,gBAAgB,GAAG,OAAO,CAAC,gBAAgB,EAAE,MAAM,GAAG,OAAO,CAAC,MAAM,CAAC;AAC9H,QAAQ,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC;AAC/B,QAAQ,IAAI,MAAM,GAAG,gBAAgB,CAAC,IAAI,CAAC,aAAa,CAAC,WAAW,CAAC;AACrE;AACA,QAAQ,IAAI,aAAa,GAAG,UAAU,EAAE,EAAE;AAC1C,YAAY,gBAAgB,CAAC,KAAK,CAAC,WAAW,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;AACxD,SAAS,CAAC;AACV,QAAQ,IAAI,WAAW,GAAG,UAAU,EAAE,EAAE;AACxC,YAAY,gBAAgB,CAAC,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;AACtD,SAAS,CAAC;AACV,QAAQ,IAAI,aAAa,GAAG,UAAU,EAAE,EAAE;AAC1C,YAAY,gBAAgB,CAAC,KAAK,CAAC,WAAW,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;AACxD,SAAS,CAAC;AACV,QAAQ,IAAI,aAAa,GAAG,UAAU,EAAE,EAAE;AAC1C,YAAY,gBAAgB,CAAC,KAAK,CAAC,WAAW,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;AACxD,SAAS,CAAC;AACV,QAAQ,IAAI,YAAY,GAAG,UAAU,EAAE,EAAE;AACzC,YAAY,gBAAgB,CAAC,KAAK,CAAC,UAAU,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;AACvD,SAAS,CAAC;AACV,QAAQ,IAAI,eAAe,GAAG,UAAU,EAAE,EAAE;AAC5C,YAAY,gBAAgB,CAAC,KAAK,CAAC,aAAa,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;AAC1D,SAAS,CAAC;AACV,QAAQ,IAAI,cAAc,GAAG,UAAU,EAAE,EAAE;AAC3C,YAAY,gBAAgB,CAAC,KAAK,CAAC,YAAY,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;AACzD,SAAS,CAAC;AACV,QAAQ,IAAI,OAAO,GAAG,UAAU,EAAE,EAAE;AACpC,YAAY,gBAAgB,CAAC,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;AAClD,SAAS,CAAC;AACV,QAAQ,IAAI,uBAAuB,GAAG,UAAU,GAAG,EAAE;AACrD,YAAY,OAAO,CAAC,UAAU,CAAC,QAAQ,CAAC,gBAAgB,CAAC,aAAa,EAAE,aAAa,EAAE,IAAI,CAAC,CAAC;AAC7F,YAAY,GAAG,CAAC,gBAAgB,CAAC,aAAa,EAAE,aAAa,EAAE,IAAI,CAAC,CAAC;AACrE,YAAY,GAAG,CAAC,gBAAgB,CAAC,cAAc,EAAE,YAAY,EAAE,IAAI,CAAC,CAAC;AACrE,YAAY,GAAG,CAAC,gBAAgB,CAAC,aAAa,EAAE,aAAa,EAAE,IAAI,CAAC,CAAC;AACrE,YAAY,OAAO,CAAC,UAAU,CAAC,gBAAgB,CAAC,WAAW,EAAE,WAAW,EAAE,IAAI,CAAC,CAAC;AAChF,YAAY,OAAO,CAAC,UAAU,CAAC,gBAAgB,CAAC,eAAe,EAAE,eAAe,EAAE,IAAI,CAAC,CAAC;AACxF,SAAS,CAAC;AACV,QAAQ,IAAI,qBAAqB,GAAG,UAAU,GAAG,EAAE;AACnD,YAAY,GAAG,CAAC,gBAAgB,CAAC,YAAY,EAAE,aAAa,EAAE,IAAI,CAAC,CAAC;AACpE,YAAY,GAAG,CAAC,gBAAgB,CAAC,UAAU,EAAE,WAAW,EAAE,IAAI,CAAC,CAAC;AAChE,YAAY,GAAG,CAAC,gBAAgB,CAAC,WAAW,EAAE,aAAa,EAAE,IAAI,CAAC,CAAC;AACnE,YAAY,GAAG,CAAC,gBAAgB,CAAC,aAAa,EAAE,eAAe,EAAE,IAAI,CAAC,CAAC;AACvE,SAAS,CAAC;AACV,QAAQ,IAAI,qBAAqB,GAAG,UAAU,GAAG,EAAE;AACnD,YAAY,OAAO,CAAC,UAAU,CAAC,QAAQ,CAAC,gBAAgB,CAAC,WAAW,EAAE,aAAa,EAAE,IAAI,CAAC,CAAC;AAC3F,YAAY,GAAG,CAAC,gBAAgB,CAAC,WAAW,EAAE,aAAa,EAAE,IAAI,CAAC,CAAC;AACnE,YAAY,GAAG,CAAC,gBAAgB,CAAC,UAAU,EAAE,YAAY,EAAE,IAAI,CAAC,CAAC;AACjE,YAAY,GAAG,CAAC,gBAAgB,CAAC,WAAW,EAAE,aAAa,EAAE,IAAI,CAAC,CAAC;AACnE,YAAY,OAAO,CAAC,UAAU,CAAC,gBAAgB,CAAC,SAAS,EAAE,WAAW,EAAE,IAAI,CAAC,CAAC;AAC9E,SAAS,CAAC;AACV,QAAQ,IAAI,0BAA0B,GAAG,UAAU,GAAG,EAAE;AACxD,YAAY,OAAO,CAAC,UAAU,CAAC,QAAQ,CAAC,mBAAmB,CAAC,aAAa,EAAE,aAAa,EAAE,IAAI,CAAC,CAAC;AAChG,YAAY,GAAG,CAAC,mBAAmB,CAAC,aAAa,EAAE,aAAa,EAAE,IAAI,CAAC,CAAC;AACxE,YAAY,GAAG,CAAC,mBAAmB,CAAC,cAAc,EAAE,YAAY,EAAE,IAAI,CAAC,CAAC;AACxE,YAAY,GAAG,CAAC,mBAAmB,CAAC,aAAa,EAAE,aAAa,EAAE,IAAI,CAAC,CAAC;AACxE,YAAY,OAAO,CAAC,UAAU,CAAC,mBAAmB,CAAC,WAAW,EAAE,WAAW,EAAE,IAAI,CAAC,CAAC;AACnF,SAAS,CAAC;AACV,QAAQ,IAAI,wBAAwB,GAAG,UAAU,GAAG,EAAE;AACtD,YAAY,GAAG,CAAC,mBAAmB,CAAC,YAAY,EAAE,aAAa,EAAE,IAAI,CAAC,CAAC;AACvE,YAAY,GAAG,CAAC,mBAAmB,CAAC,UAAU,EAAE,WAAW,EAAE,IAAI,CAAC,CAAC;AACnE,YAAY,GAAG,CAAC,mBAAmB,CAAC,WAAW,EAAE,aAAa,EAAE,IAAI,CAAC,CAAC;AACtE,YAAY,GAAG,CAAC,mBAAmB,CAAC,aAAa,EAAE,eAAe,EAAE,IAAI,CAAC,CAAC;AAC1E,SAAS,CAAC;AACV,QAAQ,IAAI,wBAAwB,GAAG,UAAU,GAAG,EAAE;AACtD,YAAY,OAAO,CAAC,UAAU,CAAC,QAAQ,CAAC,mBAAmB,CAAC,WAAW,EAAE,aAAa,EAAE,IAAI,CAAC,CAAC;AAC9F,YAAY,GAAG,CAAC,mBAAmB,CAAC,WAAW,EAAE,aAAa,EAAE,IAAI,CAAC,CAAC;AACtE,YAAY,GAAG,CAAC,mBAAmB,CAAC,UAAU,EAAE,YAAY,EAAE,IAAI,CAAC,CAAC;AACpE,YAAY,GAAG,CAAC,mBAAmB,CAAC,WAAW,EAAE,aAAa,EAAE,IAAI,CAAC,CAAC;AACtE,YAAY,OAAO,CAAC,UAAU,CAAC,mBAAmB,CAAC,SAAS,EAAE,WAAW,EAAE,IAAI,CAAC,CAAC;AACjF,SAAS,CAAC;AACV,QAAQ,gBAAgB,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,oBAAoB,CAAC,GAAG,EAAE,YAAY;AAC9E,YAAY,IAAI,GAAG,GAAG,KAAK,CAAC,OAAO,CAAC,cAAc,CAAC,aAAa,EAAE,CAAC;AACnE;AACA,YAAY,IAAI,OAAO,CAAC,UAAU,CAAC,SAAS,CAAC,gBAAgB,EAAE;AAC/D;AACA,gBAAgB,GAAG,CAAC,KAAK,CAAC,gBAAgB,GAAG,MAAM,CAAC;AACpD;AACA,gBAAgB,GAAG,CAAC,KAAK,CAAC,aAAa,GAAG,MAAM,CAAC;AACjD,aAAa;AACb,iBAAiB,IAAI,MAAM,CAAC,qBAAqB,EAAE;AACnD,gBAAgB,GAAG,CAAC,KAAK,CAAC,WAAW,GAAG,MAAM,CAAC;AAC/C,aAAa;AACb,YAAY,IAAI,MAAM,CAAC,qBAAqB,EAAE;AAC9C,gBAAgB,uBAAuB,CAAC,GAAG,CAAC,CAAC;AAC7C,aAAa;AACb,iBAAiB;AACjB,gBAAgB,qBAAqB,CAAC,GAAG,CAAC,CAAC;AAC3C,aAAa;AACb,YAAY,IAAI,MAAM,CAAC,mBAAmB,EAAE;AAC5C,gBAAgB,qBAAqB,CAAC,GAAG,CAAC,CAAC;AAC3C,aAAa;AACb,YAAY,IAAI,MAAM,CAAC,mBAAmB,EAAE;AAC5C,gBAAgB,GAAG,CAAC,gBAAgB,CAAC,OAAO,EAAE,OAAO,EAAE,IAAI,CAAC,CAAC;AAC7D,aAAa;AACb;AACA;AACA,YAAY,GAAG,CAAC,gBAAgB,CAAC,OAAO,EAAE,cAAc,EAAE;AAC1D,gBAAgB,OAAO,EAAE,IAAI;AAC7B,gBAAgB,OAAO,EAAE,IAAI;AAC7B,aAAa,CAAC,CAAC;AACf,SAAS,CAAC,CAAC;AACX,QAAQ,gBAAgB,CAAC,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,oBAAoB,CAAC,GAAG,EAAE,YAAY;AACjF,YAAY,IAAI,GAAG,GAAG,KAAK,CAAC,OAAO,CAAC,cAAc,CAAC,aAAa,EAAE,CAAC;AACnE;AACA,YAAY,IAAI,OAAO,CAAC,UAAU,CAAC,SAAS,CAAC,gBAAgB,EAAE;AAC/D;AACA,gBAAgB,GAAG,CAAC,KAAK,CAAC,gBAAgB,GAAG,EAAE,CAAC;AAChD;AACA,gBAAgB,GAAG,CAAC,KAAK,CAAC,aAAa,GAAG,EAAE,CAAC;AAC7C,aAAa;AACb,iBAAiB,IAAI,MAAM,CAAC,qBAAqB,EAAE;AACnD,gBAAgB,GAAG,CAAC,KAAK,CAAC,WAAW,GAAG,EAAE,CAAC;AAC3C,aAAa;AACb,YAAY,IAAI,MAAM,CAAC,qBAAqB,EAAE;AAC9C,gBAAgB,0BAA0B,CAAC,GAAG,CAAC,CAAC;AAChD,aAAa;AACb,iBAAiB;AACjB,gBAAgB,wBAAwB,CAAC,GAAG,CAAC,CAAC;AAC9C,aAAa;AACb,YAAY,IAAI,MAAM,CAAC,mBAAmB,EAAE;AAC5C,gBAAgB,wBAAwB,CAAC,GAAG,CAAC,CAAC;AAC9C,aAAa;AACb,YAAY,IAAI,MAAM,CAAC,mBAAmB,EAAE;AAC5C,gBAAgB,GAAG,CAAC,mBAAmB,CAAC,OAAO,EAAE,OAAO,EAAE,IAAI,CAAC,CAAC;AAChE,aAAa;AACb,YAAY,GAAG,CAAC,mBAAmB,CAAC,OAAO,EAAE,cAAc,EAAE,IAAI,CAAC,CAAC;AACnE,SAAS,CAAC,CAAC;AACX,KAAK,CAAC;AACN,IAAI,oBAAoB,CAAC,GAAG,GAAG,gBAAgB,CAAC;AAChD,IAAI,OAAO,oBAAoB,CAAC;AAChC,CAAC,EAAE,CAAC;;ACvID,IAAC,MAAM,kBAAkB,UAAU,MAAM,EAAE;AAC9C,IAAIA,eAAS,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;AAC9B,IAAI,SAAS,MAAM,GAAG;AACtB,QAAQ,IAAI,KAAK,GAAG,MAAM,KAAK,IAAI,IAAI,MAAM,CAAC,KAAK,CAAC,IAAI,EAAE,SAAS,CAAC,IAAI,IAAI,CAAC;AAC7E,QAAQ,KAAK,CAAC,IAAI,GAAG,iBAAiB,CAAC;AACvC,QAAQ,OAAO,KAAK,CAAC;AACrB,KAAK;AACL,IAAI,MAAM,CAAC,SAAS,CAAC,IAAI,GAAG,YAAY;AACxC,QAAQ,IAAI,CAAC,kBAAkB,CAAC,IAAI,oBAAoB,EAAE,CAAC,CAAC;AAC5D,KAAK,CAAC;AACN,IAAI,MAAM,CAAC,SAAS,CAAC,OAAO,GAAG,YAAY;AAC3C,QAAQ,IAAI,CAAC,yBAAyB,EAAE,CAAC;AACzC,KAAK,CAAC;AACN,IAAI,OAAO,MAAM,CAAC;AAClB,CAAC,CAACC,4BAAsB,CAAC;;;;"}